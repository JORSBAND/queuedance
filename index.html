<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ì—Ä–∞—Ñ—ñ–∫ —Ä–µ–ø–µ—Ç–∏—Ü—ñ–π</title>
    <!-- Tailwind CSS –¥–ª—è —Å—Ç–∏–ª—ñ–≤ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React —Ç–∞ ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <!-- Babel –¥–ª—è –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó JSX –≤ –±—Ä–∞—É–∑–µ—Ä—ñ -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .animate-slide-up { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        body { -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 font-sans pb-10">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, addDoc, deleteDoc, doc, setDoc, getDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const { useState, useEffect, useMemo } = React;

        // –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≤–∞—à —Å–∞–π—Ç (–±—É–¥–µ –ø—Ä–∏–∫—Ä—ñ–ø–ª–µ–Ω–æ —è–∫ –∫–Ω–æ–ø–∫–∞ –≤ Telegram). 
        // –Ø–∫—â–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—à –Ω–∞ GitHub, –∑–∞–º—ñ–Ω–∏ —Ü–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Å–≤–æ—î –∑ GitHub Pages!
        const SITE_URL = "https://vhrchat.firebaseapp.com"; 

        const firebaseConfig = {
            apiKey: "AIzaSyCm8nZvhps4yeYDzPNyKLI_PvadAOeYI20",
            authDomain: "vhrchat.firebaseapp.com",
            projectId: "vhrchat",
            storageBucket: "vhrchat.firebasestorage.app",
            messagingSenderId: "1039293838718",
            appId: "1:1039293838718:web:b74fddda402267040bef2f",
            measurementId: "G-R9XY6JRZMF"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const COLLECTION_NAME = 'rehearsals';

        const CLASSES = ["5–ê", "5–ë", "5–í", "6–ê", "6–ë", "7–ê", "7–ë"];
        const HALLS = [
            { id: 'choreography', name: '–•–æ—Ä–µ–æ–≥—Ä–∞—Ñ—ñ—á–Ω–∏–π' },
            { id: 'assembly', name: '–ê–∫—Ç–æ–≤–∏–π' }
        ];
        const DANCE_TYPES = [
            { id: 'waltz', name: '–í–∞–ª—å—Å' },
            { id: 'general', name: '–ó–∞–≥–∞–ª—å–Ω–∏–π —Ç–∞–Ω–µ—Ü—å' }
        ];
        const DAYS = [
            { id: 1, name: '–ü–æ–Ω–µ–¥—ñ–ª–æ–∫', short: '–ü–ù' },
            { id: 2, name: '–í—ñ–≤—Ç–æ—Ä–æ–∫', short: '–í–¢' },
            { id: 3, name: '–°–µ—Ä–µ–¥–∞', short: '–°–†' },
            { id: 4, name: '–ß–µ—Ç–≤–µ—Ä', short: '–ß–¢' },
            { id: 5, name: '–ü\'—è—Ç–Ω–∏—Ü—è', short: '–ü–¢' }
        ];
        const LESSON_TIMES = {
            1: "08:30 - 09:15",
            2: "09:25 - 10:10",
            3: "10:30 - 11:15",
            4: "11:25 - 12:10",
            5: "12:30 - 13:15",
            6: "13:25 - 14:10",
            7: "14:20 - 15:05",
            8: "15:10 - 15:55",
            9: "16:00 - 16:45"
        };
        const ADMIN_PASSWORD = "44442222";

        const IconUser = ({ size=24, className="" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;
        const IconMapPin = ({ size=24, className="" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>;
        const IconTrash = ({ size=24, className="" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>;
        const IconPlus = ({ size=24, className="" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
        const IconInfo = ({ size=24, className="" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>;
        const IconShield = ({ size=24, className="" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>;
        const IconChevronLeft = ({ size=24, className="" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="15 18 9 12 15 6"/></svg>;
        const IconChevronRight = ({ size=24, className="" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="9 18 15 12 9 6"/></svg>;
        const IconClock = ({ size=24, className="" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;
        const IconTelegram = ({ size=24, className="" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>;

        const TG_BOT_TOKEN = "8790781183:AAHL1o0mrmqFSRt63mXmS1lNvAYZWJMnvlE";

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Ç–∏–∂–¥–µ–Ω—å –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –∑—Å—É–≤—É
        const getWeekInfo = (offset) => {
            const d = new Date();
            // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –ø–æ–Ω–µ–¥—ñ–ª–æ–∫ –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Ç–∏–∂–Ω—è
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1);
            d.setDate(diff);
            d.setHours(0,0,0,0);
            
            // –î–æ–¥–∞—î–º–æ –∑—Å—É–≤ –ø–æ —Ç–∏–∂–Ω—è—Ö
            d.setDate(d.getDate() + offset * 7);
            
            const monday = new Date(d);
            const friday = new Date(d);
            friday.setDate(friday.getDate() + 4);

            const target = new Date(monday);
            target.setDate(target.getDate() + 3 - (target.getDay() + 6) % 7);
            const week1 = new Date(target.getFullYear(), 0, 4);
            const weekNumber = 1 + Math.round(((target.getTime() - week1.getTime()) / 86400000 - 3 + (week1.getDay() + 6) % 7) / 7);
            const key = `${target.getFullYear()}-W${weekNumber}`;

            const formatD = (date) => `${date.getDate().toString().padStart(2, '0')}.${(date.getMonth() + 1).toString().padStart(2, '0')}`;

            return {
                key,
                label: `–¢–∏–∂–¥. ${weekNumber} (${formatD(monday)}-${formatD(friday)})`,
                mondayMonth: monday.getMonth(),
                mondayYear: monday.getFullYear()
            };
        };

        function App() {
            const [user, setUser] = useState(null);
            const [profile, setProfile] = useState(null);
            const [isAdmin, setIsAdmin] = useState(() => localStorage.getItem('rehearsals_admin') === 'true');
            const [rehearsals, setRehearsals] = useState([]);
            
            // UI –°—Ç–µ–π—Ç
            const [weekOffset, setWeekOffset] = useState(0); // 0 = –ø–æ—Ç–æ—á–Ω–∏–π —Ç–∏–∂–¥–µ–Ω—å, 1 = –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Ç–æ—â–æ
            const [selectedDay, setSelectedDay] = useState(new Date().getDay() >= 1 && new Date().getDay() <= 5 ? new Date().getDay() : 1);
            const [selectedHall, setSelectedHall] = useState(HALLS[0].id);
            const [loading, setLoading] = useState(true);
            
            const [authModalOpen, setAuthModalOpen] = useState(false);
            const [adminLoginModalOpen, setAdminLoginModalOpen] = useState(false);
            const [bookingModal, setBookingModal] = useState({ open: false, lesson: null });
            const [messageModal, setMessageModal] = useState({ open: false, title: '', text: '' });
            const [adminCustomEventText, setAdminCustomEventText] = useState('');

            // Telegram –°—Ç–µ–π—Ç
            const [tgModalOpen, setTgModalOpen] = useState(false);
            const [tgChatId, setTgChatId] = useState(() => localStorage.getItem('tg_chat_id'));
            const [tgChatTitle, setTgChatTitle] = useState(() => localStorage.getItem('tg_chat_title'));
            const [tgLoading, setTgLoading] = useState(false);
            const [tgWeekOffset, setTgWeekOffset] = useState(0);
            const [tgDays, setTgDays] = useState(['all']);

            // –î–∞–Ω—ñ –æ–±—Ä–∞–Ω–æ–≥–æ —Ç–∏–∂–Ω—è
            const currentWeekInfo = useMemo(() => getWeekInfo(weekOffset), [weekOffset]);
            
            // –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö —Ç–∏–∂–Ω—ñ–≤ –¥–ª—è Telegram —Ä–æ–∑—Å–∏–ª–∫–∏
            const availableWeeks = useMemo(() => {
                const weeks = [];
                for(let i = 0; i <= 10; i++) {
                    const wInfo = getWeekInfo(i);
                    if (wInfo.mondayMonth > 2 && wInfo.mondayYear >= new Date().getFullYear()) {
                        if (i > 0) break;
                    }
                    weeks.push({ offset: i, ...wInfo });
                }
                return weeks;
            }, []);

            // –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –º–æ–¥–∞–ª–∫–∏ –∑ –æ–±—Ä–∞–Ω–∏–º –¥–Ω–µ–º/—Ç–∏–∂–Ω–µ–º
            useEffect(() => {
                if(tgModalOpen) {
                    setTgWeekOffset(weekOffset);
                    setTgDays([selectedDay]);
                }
            }, [tgModalOpen, weekOffset, selectedDay]);

            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Ç–∏–∂–¥–µ–Ω—å –≤–∂–µ –≤–∏—Ö–æ–¥–∏—Ç—å –∑–∞ –º–µ–∂—ñ –±–µ—Ä–µ–∑–Ω—è (–º—ñ—Å—è—Ü—å > 2)
            const nextWeekInfo = useMemo(() => getWeekInfo(weekOffset + 1), [weekOffset]);
            const isNextWeekPastMarch = nextWeekInfo.mondayMonth > 2 && nextWeekInfo.mondayYear >= new Date().getFullYear();

            // 1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è
            useEffect(() => {
                const initAuth = async () => {
                    try {
                        await signInAnonymously(auth);
                    } catch (error) {
                        console.error("–ü–æ–º–∏–ª–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó:", error);
                        showMessage("–ü–æ–º–∏–ª–∫–∞", "–ù–µ –≤–¥–∞–ª–æ—Å—è –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Firebase.");
                    }
                };

                initAuth();

                const unsubscribe = onAuthStateChanged(auth, (currentUser) => {
                    setUser(currentUser);
                    if (currentUser) {
                        const savedProfile = localStorage.getItem('rehearsal_profile');
                        if (savedProfile) {
                            setProfile(JSON.parse(savedProfile));
                        } else {
                            setAuthModalOpen(true);
                        }
                    } else {
                        setLoading(false);
                    }
                });

                return () => unsubscribe();
            }, []);

            // 2. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ Firestore
            useEffect(() => {
                if (!user) return;

                const rehearsalsRef = collection(db, COLLECTION_NAME);
                
                const unsubscribe = onSnapshot(rehearsalsRef, (snapshot) => {
                    const data = snapshot.docs
                        .map(doc => ({ id: doc.id, ...doc.data() }))
                        .filter(doc => doc.id !== 'tg_config'); // –§—ñ–ª—å—Ç—Ä—É—î–º–æ —Ç–µ—Ö–Ω—ñ—á–Ω–∏–π –¥–æ–∫—É–º–µ–Ω—Ç Telegram
                    setRehearsals(data);
                    setLoading(false);
                }, (error) => {
                    console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö:", error);
                    setLoading(false);
                });

                return () => unsubscribe();
            }, [user]);

            const saveProfile = () => {
                const classSelect = document.getElementById('class-select').value;
                const nameInput = document.getElementById('name-input').value;

                if (!nameInput.trim() || !classSelect) {
                    showMessage("–£–≤–∞–≥–∞", "–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —Å–≤–æ—î —ñ–º'—è —Ç–∞ –æ–±–µ—Ä—ñ—Ç—å –∫–ª–∞—Å.");
                    return;
                }
                const newProfile = { name: nameInput.trim(), className: classSelect };
                localStorage.setItem('rehearsal_profile', JSON.stringify(newProfile));
                setProfile(newProfile);
                setAuthModalOpen(false);
            };

            const logOut = () => {
                localStorage.removeItem('rehearsal_profile');
                setProfile(null);
                setIsAdmin(false);
                localStorage.removeItem('rehearsals_admin');
                setAuthModalOpen(true);
            };

            const handleAdminLogin = () => {
                const pwd = document.getElementById('admin-pwd-input').value;
                if (pwd === ADMIN_PASSWORD) {
                    setIsAdmin(true);
                    localStorage.setItem('rehearsals_admin', 'true');
                    setAdminLoginModalOpen(false);
                    showMessage("–£—Å–ø—ñ—Ö", "–í–∏ —É–≤—ñ–π—à–ª–∏ —è–∫ –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä.");
                } else {
                    showMessage("–ü–æ–º–∏–ª–∫–∞", "–ù–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å.");
                }
            };

            const toggleAdminLogin = () => {
                if (isAdmin) {
                    setIsAdmin(false);
                    localStorage.removeItem('rehearsals_admin');
                    showMessage("–Ü–Ω—Ñ–æ", "–í–∏ –≤–∏–π—à–ª–∏ –∑ —Ä–µ–∂–∏–º—É –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.");
                } else {
                    setAdminLoginModalOpen(true);
                }
            };

            const showMessage = (title, text) => {
                setMessageModal({ open: true, title, text });
            };

            const handleSlotClick = (lessonNumber) => {
                if (!isAdmin) {
                    const classBookingsToday = rehearsals.filter(r => 
                        r.weekKey === currentWeekInfo.key && 
                        r.day === selectedDay && 
                        r.className === profile.className &&
                        r.danceType !== 'custom'
                    );

                    if (classBookingsToday.length >= 2) {
                        showMessage("–õ—ñ–º—ñ—Ç –≤–∏—á–µ—Ä–ø–∞–Ω–æ", `–ö–ª–∞—Å ${profile.className} –≤–∂–µ –∑–∞–±—Ä–æ–Ω—é–≤–∞–≤ –º–∞–∫—Å–∏–º—É–º (2) —Ä–µ–ø–µ—Ç–∏—Ü—ñ—ó –Ω–∞ —Ü–µ–π –¥–µ–Ω—å.`);
                        return;
                    }
                }

                setAdminCustomEventText('');
                setBookingModal({ open: true, lesson: lessonNumber });
            };

            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ Telegram
            const triggerTgUpdate = async () => {
                try {
                    const tgConfigRef = doc(db, COLLECTION_NAME, 'tg_config');
                    const tgSnap = await getDoc(tgConfigRef);
                    
                    if (tgSnap.exists()) {
                        const config = tgSnap.data();
                        if (!config.chatId || !config.messageId) return;

                        // –û—Ç—Ä–∏–º—É—î–º–æ –Ω–∞–π—Å–≤—ñ–∂—ñ—à—ñ –¥–∞–Ω—ñ –∑ –±–∞–∑–∏
                        const snap = await getDocs(collection(db, COLLECTION_NAME));
                        const allR = snap.docs
                            .map(d => ({id: d.id, ...d.data()}))
                            .filter(d => d.id !== 'tg_config');

                        const text = generateTgText(config.weekLabel, config.weekKey, config.days, allR);
                        
                        const replyMarkup = {
                            inline_keyboard: [[{ text: "üëâ –í—ñ–¥–∫—Ä–∏—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫ –Ω–∞ —Å–∞–π—Ç—ñ", url: SITE_URL }]]
                        };

                        await fetch(`https://api.telegram.org/bot${TG_BOT_TOKEN}/editMessageText`, {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({
                                chat_id: config.chatId,
                                message_id: config.messageId,
                                text: text,
                                parse_mode: 'HTML',
                                reply_markup: replyMarkup
                            })
                        });
                    }
                } catch (e) {
                    console.error("–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è Telegram:", e);
                }
            };

            const confirmBooking = async () => {
                if (!user || !profile || !bookingModal.lesson) return;

                let finalClassName = profile.className;
                let finalResponsibleName = profile.name;
                let finalDanceType = 'general';

                if (isAdmin && adminCustomEventText.trim() !== '') {
                    finalClassName = adminCustomEventText.trim();
                    finalResponsibleName = '–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ü—ñ—è';
                    finalDanceType = 'custom';
                } else {
                    const selectedTypeInput = document.querySelector('input[name="danceType"]:checked');
                    if (selectedTypeInput) {
                        finalDanceType = selectedTypeInput.value;
                    }
                }

                const newBooking = {
                    weekKey: currentWeekInfo.key,
                    day: selectedDay,
                    lesson: bookingModal.lesson,
                    hall: selectedHall,
                    danceType: finalDanceType,
                    className: finalClassName,
                    responsibleName: finalResponsibleName,
                    uid: user.uid,
                    createdAt: Date.now()
                };

                try {
                    await addDoc(collection(db, COLLECTION_NAME), newBooking);
                    setBookingModal({ open: false, lesson: null });
                    await triggerTgUpdate(); // –ê–≤—Ç–æ-–æ–Ω–æ–≤–ª–µ–Ω–Ω—è Telegram
                } catch (error) {
                    console.error("–ü–æ–º–∏–ª–∫–∞ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è:", error);
                    showMessage("–ü–æ–º–∏–ª–∫–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö", "–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ –≤–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–ª–∏ –±–∞–∑—É –¥–∞–Ω–∏—Ö Firebase.");
                }
            };

            const handleDelete = async (bookingId) => {
                try {
                    await deleteDoc(doc(db, COLLECTION_NAME, bookingId));
                    await triggerTgUpdate(); // –ê–≤—Ç–æ-–æ–Ω–æ–≤–ª–µ–Ω–Ω—è Telegram
                } catch (error) {
                    console.error("–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è:", error);
                    showMessage("–ü–æ–º–∏–ª–∫–∞", "–ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–¥–∞–ª–∏—Ç–∏ —Ä–µ–ø–µ—Ç–∏—Ü—ñ—é.");
                }
            };

            // --- Telegram –õ–æ–≥—ñ–∫–∞ ---
            const findTgGroup = async () => {
                setTgLoading(true);
                try {
                    const res = await fetch(`https://api.telegram.org/bot${TG_BOT_TOKEN}/getUpdates`);
                    const data = await res.json();
                    if (data.ok && data.result.length > 0) {
                        // –®—É–∫–∞—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —Å–∞–º–µ –∑ –≥—Ä—É–ø–∏ (group –∞–±–æ supergroup)
                        const groupUpdate = data.result.reverse().find(u => u.message && (u.message.chat.type === 'group' || u.message.chat.type === 'supergroup'));
                        if (groupUpdate) {
                            const id = groupUpdate.message.chat.id;
                            const title = groupUpdate.message.chat.title;
                            localStorage.setItem('tg_chat_id', id);
                            localStorage.setItem('tg_chat_title', title);
                            setTgChatId(id);
                            setTgChatTitle(title);
                            showMessage("–£—Å–ø—ñ—Ö", `–ì—Ä—É–ø—É "${title}" –∑–Ω–∞–π–¥–µ–Ω–æ —Ç–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ!`);
                        } else {
                            showMessage("–ü–æ–º–∏–ª–∫–∞", "–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –∑ –≥—Ä—É–ø–∏. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ –Ω–∞–ø–∏—Å–∞–ª–∏ —Å–∞–º–µ –∫–æ–º–∞–Ω–¥—É /start —É –≥—Ä—É–ø—É.");
                        }
                    } else {
                         showMessage("–ü–æ–º–∏–ª–∫–∞", "–ù–µ–º–∞—î –Ω–æ–≤–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å. –ù–∞–ø–∏—à—ñ—Ç—å –∫–æ–º–∞–Ω–¥—É /start —É –≥—Ä—É–ø—É —ñ —Å–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.");
                    }
                } catch (e) {
                     showMessage("–ü–æ–º–∏–ª–∫–∞", "–ü–æ–º–∏–ª–∫–∞ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ Telegram. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç.");
                }
                setTgLoading(false);
            };

            const generateTgText = (targetWeekLabel, targetWeekKey, targetDays, allRehearsals) => {
                let text = `üóì <b>–ì—Ä–∞—Ñ—ñ–∫ —Ä–µ–ø–µ—Ç–∏—Ü—ñ–π</b>\n`;
                text += `–¢–∏–∂–¥–µ–Ω—å: ${targetWeekLabel}\n`;

                const daysToProcess = targetDays.includes('all') ? DAYS : DAYS.filter(d => targetDays.includes(d.id));

                daysToProcess.forEach(day => {
                    text += `\nüìÖ <b>${day.name.toUpperCase()}</b>\n`;

                    HALLS.forEach(hall => {
                        text += `\nüìç <i>${hall.name} –∑–∞–ª:</i>\n`;
                        
                        // –ü—Ä–æ—Ö–æ–¥–∏–º–æ—Å—å –ø–æ –≤—Å—ñ—Ö 9 —É—Ä–æ–∫–∞—Ö, —â–æ–± –ø–æ–∫–∞–∑–∞—Ç–∏ —ñ –≤—ñ–ª—å–Ω—ñ, —ñ –∑–∞–π–Ω—è—Ç—ñ
                        for (let lesson = 1; lesson <= 9; lesson++) {
                            const r = allRehearsals.find(x => x.weekKey === targetWeekKey && x.day === day.id && x.hall === hall.id && x.lesson === lesson);
                            
                            if (r) {
                                let danceName = r.danceType === 'custom' ? '–°–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ –ø–æ–¥—ñ—è' : (DANCE_TYPES.find(d=>d.id===r.danceType)?.name || '');
                                text += `‚Ä¢ ${lesson} —É—Ä–æ–∫ (${LESSON_TIMES[lesson]}) ‚Äî <b>${r.className}</b> (${danceName})\n`;
                            } else {
                                text += `‚Ä¢ ${lesson} —É—Ä–æ–∫ (${LESSON_TIMES[lesson]}) ‚Äî <i>–í—ñ–ª—å–Ω–∏–π</i> ‚úÖ\n`;
                            }
                        }
                    });
                });

                // –ü–æ—Å–∏–ª–∞–Ω–Ω—è —Ç–µ–ø–µ—Ä —É –≤–∏–≥–ª—è–¥—ñ Inline-–∫–Ω–æ–ø–∫–∏
                return text;
            };

            const sendTgMessage = async () => {
                if (!tgChatId) return;
                const targetWeekInfo = getWeekInfo(tgWeekOffset);
                const text = generateTgText(targetWeekInfo.label, targetWeekInfo.key, tgDays, rehearsals);
                
                const replyMarkup = {
                    inline_keyboard: [[{ text: "üëâ –í—ñ–¥–∫—Ä–∏—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫ –Ω–∞ —Å–∞–π—Ç—ñ", url: SITE_URL }]]
                };

                setTgLoading(true);
                try {
                    const res = await fetch(`https://api.telegram.org/bot${TG_BOT_TOKEN}/sendMessage`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            chat_id: tgChatId,
                            text: text,
                            parse_mode: 'HTML',
                            reply_markup: replyMarkup
                        })
                    });
                    const data = await res.json();
                    if(data.ok) {
                        // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ ID –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ –±–∞–∑—É, —â–æ–± –ø–æ—Ç—ñ–º –π–æ–≥–æ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏
                        await setDoc(doc(db, COLLECTION_NAME, 'tg_config'), {
                            chatId: tgChatId,
                            messageId: data.result.message_id,
                            weekKey: targetWeekInfo.key,
                            weekLabel: targetWeekInfo.label,
                            days: tgDays,
                            updatedAt: Date.now()
                        });

                        showMessage("–£—Å–ø—ñ—Ö", "–ì—Ä–∞—Ñ—ñ–∫ —É—Å–ø—ñ—à–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –≥—Ä—É–ø—É Telegram!");
                        setTgModalOpen(false);
                    } else {
                        showMessage("–ü–æ–º–∏–ª–∫–∞", "–ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –±–æ—Ç –≤—Å–µ —â–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –≥—Ä—É–ø—ñ —ñ —á–∏ –º–∞—î –ø—Ä–∞–≤–∞.");
                    }
                } catch (e) {
                    showMessage("–ü–æ–º–∏–ª–∫–∞", "–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏.");
                }
                setTgLoading(false);
            };

            // –§—ñ–ª—å—Ç—Ä—É—î–º–æ –¥–∞–Ω—ñ –∑–∞ –æ–±—Ä–∞–Ω–∏–º —Ç–∏–∂–Ω–µ–º
            const currentViewRehearsals = rehearsals.filter(r => 
                r.weekKey === currentWeekInfo.key && 
                r.day === selectedDay && 
                r.hall === selectedHall
            );

            if (loading) {
                return <div className="min-h-screen flex items-center justify-center text-indigo-600 font-bold text-lg">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>;
            }

            return (
                <div>
                    <header className="bg-white shadow-sm sticky top-0 z-10">
                        <div className="max-w-md mx-auto px-4 py-3 flex justify-between items-start">
                            <div className="flex flex-col">
                                <h1 className="text-xl font-bold text-indigo-600 leading-tight">–†–µ–ø–µ—Ç–∏—Ü—ñ—ó</h1>
                                
                                {/* –ù–∞–≤—ñ–≥–∞—Ü—ñ—è –ø–æ —Ç–∏–∂–Ω—è—Ö */}
                                <div className="flex items-center gap-1 mt-2 bg-gray-50 rounded-lg p-0.5 border border-gray-200 w-max shadow-sm">
                                    <button 
                                        onClick={() => setWeekOffset(prev => prev - 1)} 
                                        disabled={weekOffset <= 0}
                                        className="p-1 rounded-md hover:bg-white hover:shadow-sm disabled:opacity-30 disabled:hover:bg-transparent disabled:shadow-none transition-all text-gray-600"
                                    >
                                        <IconChevronLeft size={16} />
                                    </button>
                                    <span className="text-[11px] sm:text-xs font-bold text-gray-700 min-w-[125px] text-center">
                                        {currentWeekInfo.label}
                                    </span>
                                    <button 
                                        onClick={() => setWeekOffset(prev => prev + 1)} 
                                        disabled={isNextWeekPastMarch}
                                        className="p-1 rounded-md hover:bg-white hover:shadow-sm disabled:opacity-30 disabled:hover:bg-transparent disabled:shadow-none transition-all text-gray-600"
                                    >
                                        <IconChevronRight size={16} />
                                    </button>
                                </div>
                            </div>
                            <div className="flex items-center gap-2 mt-0.5">
                                {/* –ö–Ω–æ–ø–∫–∞ Telegram (—Ç—ñ–ª—å–∫–∏ –¥–ª—è –ê–¥–º—ñ–Ω–∞) */}
                                {isAdmin && (
                                    <button onClick={() => setTgModalOpen(true)} className="p-2 rounded-full bg-blue-50 text-blue-500 hover:text-blue-700 hover:bg-blue-100 transition-colors shadow-sm border border-blue-100" title="–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≤ Telegram">
                                        <IconTelegram size={18} />
                                    </button>
                                )}
                                {/* –ö–Ω–æ–ø–∫–∞ –ê–¥–º—ñ–Ω–∞ */}
                                <button onClick={toggleAdminLogin} className={`p-2 rounded-full transition-colors ${isAdmin ? 'bg-rose-100 text-rose-600' : 'bg-gray-100 text-gray-400 hover:text-gray-600'}`}>
                                    <IconShield size={18} />
                                </button>
                                {profile && (
                                    <div className="flex items-center gap-2 bg-indigo-50 px-3 py-1.5 rounded-full border border-indigo-100 cursor-pointer" onClick={logOut}>
                                        <IconUser size={16} className="text-indigo-500" />
                                        <span className="text-sm font-medium text-indigo-700 hidden sm:inline">{profile.className}</span>
                                    </div>
                                )}
                            </div>
                        </div>

                        <div className="flex overflow-x-auto hide-scrollbar border-t border-gray-100 bg-white px-2 py-2 max-w-md mx-auto">
                            {DAYS.map(day => (
                                <button
                                    key={day.id}
                                    onClick={() => setSelectedDay(day.id)}
                                    className={`flex-1 min-w-[60px] mx-1 py-2 rounded-xl text-sm font-medium transition-colors ${
                                        selectedDay === day.id 
                                        ? 'bg-indigo-600 text-white shadow-md' 
                                        : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                    }`}
                                >
                                    {day.short}
                                </button>
                            ))}
                        </div>

                        <div className="flex p-3 gap-2 bg-gray-50 border-b border-gray-200 max-w-md mx-auto">
                            {HALLS.map(hall => (
                                <button
                                    key={hall.id}
                                    onClick={() => setSelectedHall(hall.id)}
                                    className={`flex-1 py-2.5 rounded-lg text-sm font-semibold flex items-center justify-center gap-2 transition-all ${
                                        selectedHall === hall.id
                                        ? 'bg-white text-indigo-700 border-2 border-indigo-500 shadow-sm'
                                        : 'bg-white text-gray-500 border-2 border-transparent shadow-sm'
                                    }`}
                                >
                                    <IconMapPin size={16} />
                                    {hall.name}
                                </button>
                            ))}
                        </div>
                    </header>

                    <main className="max-w-md mx-auto px-4 py-4 space-y-3">
                        {[1, 2, 3, 4, 5, 6, 7, 8, 9].map(lessonNum => {
                            const booking = currentViewRehearsals.find(r => r.lesson === lessonNum);
                            const isMyBooking = booking && user && booking.uid === user.uid;
                            const canDelete = isMyBooking || isAdmin;

                            return (
                                <div key={lessonNum} className={`p-4 rounded-2xl shadow-sm border ${booking ? 'bg-white border-gray-200' : 'bg-indigo-50/50 border-dashed border-indigo-200 hover:bg-indigo-50 cursor-pointer transition-colors'}`}
                                     onClick={() => !booking && handleSlotClick(lessonNum)}>
                                    <div className="flex justify-between items-start">
                                        <div className="flex items-center gap-3">
                                            <div className="flex flex-col items-center w-[75px] flex-shrink-0">
                                                <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm mb-1 ${booking ? (booking.danceType === 'custom' ? 'bg-rose-100 text-rose-600' : 'bg-gray-100 text-gray-500') : 'bg-indigo-100 text-indigo-600'}`}>
                                                    {lessonNum}
                                                </div>
                                                <span className="text-[10px] text-gray-500 font-semibold whitespace-nowrap">{LESSON_TIMES[lessonNum]}</span>
                                            </div>
                                            <div>
                                                {booking ? (
                                                    <>
                                                        <h3 className={`font-bold text-lg leading-none mb-1 ${booking.danceType === 'custom' ? 'text-rose-700' : 'text-gray-800'}`}>
                                                            {booking.className}
                                                        </h3>
                                                        
                                                        {booking.danceType !== 'custom' ? (
                                                            <p className="text-xs text-gray-500 font-medium bg-gray-100 px-2 py-0.5 rounded-md inline-block mb-1">
                                                                {DANCE_TYPES.find(d => d.id === booking.danceType)?.name || '–Ü–Ω—à–µ'}
                                                            </p>
                                                        ) : (
                                                            <p className="text-xs text-rose-600 font-bold bg-rose-50 border border-rose-200 px-2 py-0.5 rounded-md inline-block mb-1">
                                                                –°–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ –ø–æ–¥—ñ—è
                                                            </p>
                                                        )}
                                                        
                                                        <p className="text-sm text-gray-600 flex items-center gap-1 mt-1">
                                                            <IconUser size={12} /> {booking.responsibleName}
                                                        </p>
                                                        
                                                        {booking.createdAt && (
                                                            <p className="text-[11px] text-gray-400 flex items-center gap-1 mt-1 font-medium">
                                                                <IconClock size={10} />
                                                                {new Date(booking.createdAt).toLocaleString('uk-UA', { day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit' })}
                                                            </p>
                                                        )}
                                                    </>
                                                ) : (
                                                    <div className="h-8 flex items-center">
                                                        <span className="text-indigo-500 font-medium">–í—ñ–ª—å–Ω–µ –º—ñ—Å—Ü–µ</span>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                        
                                        {booking ? (
                                            canDelete && (
                                                <button 
                                                    onClick={(e) => { e.stopPropagation(); handleDelete(booking.id); }}
                                                    className="p-2 text-red-400 hover:text-red-600 hover:bg-red-50 rounded-full transition-colors"
                                                >
                                                    <IconTrash size={20} />
                                                </button>
                                            )
                                        ) : (
                                            <div className="p-2 text-indigo-400">
                                                <IconPlus size={20} />
                                            </div>
                                        )}
                                    </div>
                                </div>
                            );
                        })}
                    </main>

                    {/* –ú–æ–¥–∞–ª–∫–∏ */}
                    {authModalOpen && (
                        <div className="fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50 backdrop-blur-sm">
                            <div className="bg-white rounded-2xl p-6 w-full max-w-sm shadow-xl">
                                <h2 className="text-2xl font-bold text-gray-800 mb-2">–ü—Ä–∏–≤—ñ—Ç! üëã</h2>
                                <p className="text-sm text-gray-500 mb-6">–î–∞–≤–∞–π –ø–æ–∑–Ω–∞–π–æ–º–∏–º–æ—Å—å. –¶—ñ –¥–∞–Ω—ñ –±—É–¥—É—Ç—å –≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏—Å—å –ø—Ä–∏ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—ñ.</p>
                                
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">–û–±–µ—Ä—ñ—Ç—å –≤–∞—à –∫–ª–∞—Å</label>
                                        <select id="class-select" className="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none bg-white">
                                            <option value="" disabled selected>–û–±–µ—Ä—ñ—Ç—å –∫–ª–∞—Å...</option>
                                            {CLASSES.map(c => <option key={c} value={c}>{c}</option>)}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">–Ü–º'—è –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ–≥–æ</label>
                                        <input id="name-input" type="text" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –û–ª–µ–Ω–∞ –Ü–≤–∞–Ω—ñ–≤–Ω–∞" className="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none" />
                                    </div>
                                    <button onClick={saveProfile} className="w-full py-3 bg-indigo-600 text-white rounded-xl font-bold mt-4">
                                        –ó–±–µ—Ä–µ–≥—Ç–∏ —Ç–∞ –ø–æ—á–∞—Ç–∏
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {adminLoginModalOpen && (
                        <div className="fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50 backdrop-blur-sm">
                            <div className="bg-white rounded-2xl p-6 w-full max-w-sm shadow-xl animate-slide-up">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                                        <IconShield className="text-rose-500" /> –í—Ö—ñ–¥ –ê–¥–º—ñ–Ω–∞
                                    </h2>
                                    <button onClick={() => setAdminLoginModalOpen(false)} className="text-gray-400 hover:text-gray-600 p-2 text-xl">‚úï</button>
                                </div>
                                <div className="space-y-4">
                                    <div>
                                        <input id="admin-pwd-input" type="password" placeholder="–ü–∞—Ä–æ–ª—å" className="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-rose-500 outline-none" />
                                    </div>
                                    <button onClick={handleAdminLogin} className="w-full py-3 bg-rose-600 text-white rounded-xl font-bold shadow-md">
                                        –£–≤—ñ–π—Ç–∏
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {bookingModal.open && (
                        <div className="fixed inset-0 bg-black/60 flex items-end sm:items-center justify-center p-0 sm:p-4 z-50 backdrop-blur-sm">
                            <div className="bg-white rounded-t-3xl sm:rounded-2xl p-6 w-full max-w-sm shadow-xl animate-slide-up max-h-[90vh] overflow-y-auto">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-bold text-gray-800">–ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è</h2>
                                    <button onClick={() => setBookingModal({open: false, lesson: null})} className="text-gray-400 hover:text-gray-600 p-2 text-xl">‚úï</button>
                                </div>
                                
                                <div className="mb-6 bg-gray-50 p-3 rounded-xl border border-gray-100">
                                    <p className="text-sm text-gray-600 mb-1">–î–µ—Ç–∞–ª—ñ:</p>
                                    <p className="font-medium text-gray-800">{DAYS.find(d=>d.id===selectedDay)?.name}, {bookingModal.lesson} —É—Ä–æ–∫</p>
                                    <p className="font-medium text-gray-800">{HALLS.find(h=>h.id===selectedHall)?.name} –∑–∞–ª</p>
                                </div>

                                {isAdmin && (
                                    <div className="mb-6 bg-rose-50 p-3 rounded-xl border border-rose-200">
                                        <label className="block text-sm font-bold text-rose-700 mb-2">–°—Ç–∞—Ç—É—Å –≤—ñ–¥ –ê–¥–º—ñ–Ω–∞ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ):</label>
                                        <input 
                                            type="text" 
                                            value={adminCustomEventText}
                                            onChange={(e) => setAdminCustomEventText(e.target.value)}
                                            placeholder="–ù–∞–ø—Ä: –ó–∞–π–Ω—è—Ç–æ –¥–ª—è –∑–∞—Ö–æ–¥—É" 
                                            className="w-full p-2.5 border border-rose-300 rounded-lg focus:ring-2 focus:ring-rose-500 outline-none bg-white" 
                                        />
                                        <p className="text-xs text-rose-600 mt-2 leading-tight">–Ø–∫—â–æ –∑–∞–ø–æ–≤–Ω–∏—Ç–∏ —Ü–µ –ø–æ–ª–µ, —Ç–∏–ø —Ç–∞–Ω—Ü—é —ñ–≥–Ω–æ—Ä—É—î—Ç—å—Å—è, –∞ —Ä–µ–ø–µ—Ç–∏—Ü—ñ—è –≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏–º–µ—Ç—å—Å—è —è–∫ –°–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ –ø–æ–¥—ñ—è.</p>
                                    </div>
                                )}

                                <div className={`${isAdmin && adminCustomEventText.trim() !== '' ? 'opacity-50 pointer-events-none' : ''}`}>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">–¢–∏–ø —Ç–∞–Ω—Ü—é:</label>
                                    <div className="space-y-2 mb-6">
                                        {DANCE_TYPES.map(type => (
                                            <label key={type.id} className="flex items-center p-3 border border-gray-200 rounded-xl cursor-pointer hover:bg-gray-50">
                                                <input type="radio" name="danceType" value={type.id} defaultChecked={type.id === DANCE_TYPES[0].id} className="w-5 h-5 text-indigo-600" />
                                                <span className="ml-3 font-medium text-gray-700">{type.name}</span>
                                            </label>
                                        ))}
                                    </div>
                                </div>

                                <button onClick={confirmBooking} className={`w-full py-3.5 text-white rounded-xl font-bold ${isAdmin && adminCustomEventText.trim() !== '' ? 'bg-rose-600' : 'bg-indigo-600'}`}>
                                    –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ {isAdmin && adminCustomEventText.trim() !== '' ? '—Å—Ç–∞—Ç—É—Å' : '–±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è'}
                                </button>
                            </div>
                        </div>
                    )}

                    {messageModal.open && (
                        <div className="fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50 backdrop-blur-sm">
                            <div className="bg-white rounded-2xl p-6 w-full max-w-xs shadow-xl text-center">
                                <div className="w-12 h-12 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <IconInfo size={24} />
                                </div>
                                <h2 className="text-xl font-bold text-gray-800 mb-2">{messageModal.title}</h2>
                                <p className="text-gray-600 mb-6 text-sm">{messageModal.text}</p>
                                <button onClick={() => setMessageModal({open: false, title: '', text: ''})} className="w-full py-2.5 bg-gray-100 text-gray-800 font-bold rounded-xl hover:bg-gray-200">
                                    –ó—Ä–æ–∑—É–º—ñ–ª–æ
                                </button>
                            </div>
                        </div>
                    )}

                    {/* –ú–æ–¥–∞–ª–∫–∞ Telegram */}
                    {tgModalOpen && (
                        <div className="fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50 backdrop-blur-sm">
                            <div className="bg-white rounded-2xl p-6 w-full max-w-sm shadow-xl animate-slide-up">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                                        <IconTelegram className="text-blue-500" /> Telegram –†–æ–∑—Å–∏–ª–∫–∞
                                    </h2>
                                    <button onClick={() => setTgModalOpen(false)} className="text-gray-400 hover:text-gray-600 p-2 text-xl">‚úï</button>
                                </div>
                                
                                <div className="space-y-4">
                                    {!tgChatId ? (
                                        <div className="space-y-4 max-h-[70vh] overflow-y-auto hide-scrollbar pb-2">
                                            <div className="bg-blue-50 p-4 rounded-xl border border-blue-100">
                                                <p className="text-sm text-blue-800 font-bold mb-2">–°–ø–æ—Å—ñ–± 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π</p>
                                                <ol className="text-sm text-blue-700 list-decimal pl-4 space-y-1 mb-4">
                                                    <li>–î–æ–¥–∞–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram –≥—Ä—É–ø—É.</li>
                                                    <li>–ù–∞–ø–∏—à—ñ—Ç—å —É –≥—Ä—É–ø—ñ –∫–æ–º–∞–Ω–¥—É <b>/start</b> (–∑–≤–∏—á–∞–π–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –±–æ—Ç –Ω–µ –±–∞—á–∏—Ç—å).</li>
                                                    <li>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É:</li>
                                                </ol>
                                                <button 
                                                    onClick={findTgGroup} 
                                                    disabled={tgLoading}
                                                    className="w-full py-2.5 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition-colors disabled:opacity-50 flex justify-center items-center shadow-md"
                                                >
                                                    {tgLoading ? '–®—É–∫–∞—é...' : '–ó–Ω–∞–π—Ç–∏ –≥—Ä—É–ø—É'}
                                                </button>
                                            </div>
                                            
                                            <div className="bg-gray-50 p-4 rounded-xl border border-gray-200">
                                                <p className="text-sm text-gray-800 font-bold mb-2">–°–ø–æ—Å—ñ–± 2: –í—Ä—É—á–Ω—É (100% –≥–∞—Ä–∞–Ω—Ç—ñ—è)</p>
                                                <p className="text-xs text-gray-600 mb-3 leading-relaxed">
                                                    –ü–µ—Ä–µ—à–ª—ñ—Ç—å –±—É–¥—å-—è–∫–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –≤–∞—à–æ—ó –≥—Ä—É–ø–∏ –±–æ—Ç—É <b>@getmyid_bot</b>. –í—ñ–Ω –Ω–∞–¥—ñ—à–ª–µ –≤–∞–º "Forwarded from chat... id: -100XXXX". –°–∫–æ–ø—ñ—é–π—Ç–µ —Ü–µ–π ID –∑ –º—ñ–Ω—É—Å–æ–º.
                                                </p>
                                                <input 
                                                    id="manual-chat-id" 
                                                    type="text" 
                                                    placeholder="–ù–∞–ø—Ä: -100123456789" 
                                                    className="w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white mb-2 text-sm" 
                                                />
                                                <button 
                                                    onClick={() => {
                                                        const val = document.getElementById('manual-chat-id').value.trim();
                                                        if (val) {
                                                            localStorage.setItem('tg_chat_id', val);
                                                            localStorage.setItem('tg_chat_title', '–ì—Ä—É–ø–∞ (–¥–æ–¥–∞–Ω–∞ –≤—Ä—É—á–Ω—É)');
                                                            setTgChatId(val);
                                                            setTgChatTitle('–ì—Ä—É–ø–∞ (–¥–æ–¥–∞–Ω–∞ –≤—Ä—É—á–Ω—É)');
                                                        }
                                                    }}
                                                    className="w-full py-2.5 bg-gray-200 text-gray-800 rounded-lg font-bold hover:bg-gray-300 transition-colors"
                                                >
                                                    –ó–±–µ—Ä–µ–≥—Ç–∏ ID –≤—Ä—É—á–Ω—É
                                                </button>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="space-y-3">
                                            <div className="bg-green-50 text-green-700 p-3 rounded-xl border border-green-200 text-sm flex justify-between items-center">
                                                <span>–ì—Ä—É–ø–∞: <b>{tgChatTitle}</b></span>
                                                <button 
                                                    onClick={() => {
                                                        localStorage.removeItem('tg_chat_id');
                                                        localStorage.removeItem('tg_chat_title');
                                                        setTgChatId(null);
                                                    }}
                                                    className="text-xs text-red-500 underline hover:text-red-700"
                                                >
                                                    –ó–º—ñ–Ω–∏—Ç–∏
                                                </button>
                                            </div>
                                            
                                            <div className="bg-gray-50 p-3 rounded-xl border border-gray-200">
                                                <label className="block text-sm font-bold text-gray-700 mb-2">–û–±–µ—Ä—ñ—Ç—å —Ç–∏–∂–¥–µ–Ω—å:</label>
                                                <select 
                                                    value={tgWeekOffset}
                                                    onChange={(e) => setTgWeekOffset(Number(e.target.value))}
                                                    className="w-full p-2 border border-gray-300 rounded-lg text-sm bg-white outline-none mb-4"
                                                >
                                                    {availableWeeks.map(w => (
                                                        <option key={w.offset} value={w.offset}>{w.label}</option>
                                                    ))}
                                                </select>

                                                <label className="block text-sm font-bold text-gray-700 mb-2">–û–±–µ—Ä—ñ—Ç—å –¥–Ω—ñ:</label>
                                                <div className="flex flex-wrap gap-2">
                                                    <button 
                                                        onClick={() => setTgDays(['all'])}
                                                        className={`px-3 py-1.5 rounded-lg text-xs font-bold transition-colors ${tgDays.includes('all') ? 'bg-blue-600 text-white shadow-sm' : 'bg-white border border-gray-300 text-gray-600 hover:bg-gray-100'}`}
                                                    >
                                                        –í–µ—Å—å —Ç–∏–∂–¥–µ–Ω—å
                                                    </button>
                                                    {DAYS.map(d => {
                                                        const isSelected = !tgDays.includes('all') && tgDays.includes(d.id);
                                                        return (
                                                            <button 
                                                                key={d.id}
                                                                onClick={() => {
                                                                    let newDays = tgDays.includes('all') ? [] : [...tgDays];
                                                                    if (newDays.includes(d.id)) newDays = newDays.filter(id => id !== d.id);
                                                                    else newDays.push(d.id);
                                                                    
                                                                    if (newDays.length === 0 || newDays.length === 5) newDays = ['all'];
                                                                    setTgDays(newDays);
                                                                }}
                                                                className={`px-3 py-1.5 rounded-lg text-xs font-bold transition-colors ${isSelected ? 'bg-blue-600 text-white shadow-sm' : 'bg-white border border-gray-300 text-gray-600 hover:bg-gray-100'}`}
                                                            >
                                                                {d.short}
                                                            </button>
                                                        )
                                                    })}
                                                </div>
                                            </div>
                                            
                                            <button 
                                                onClick={sendTgMessage} 
                                                disabled={tgLoading}
                                                className="w-full py-3 bg-blue-600 text-white rounded-xl font-bold shadow-md hover:bg-blue-700 transition-colors disabled:opacity-50"
                                            >
                                                {tgLoading ? '–í—ñ–¥–ø—Ä–∞–≤–∫–∞...' : '–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫'}
                                            </button>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
